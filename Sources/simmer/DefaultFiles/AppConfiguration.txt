import Vapor
import AutoMigrator
import Fluent
import Leaf
::imports::

// configures your application
public func configure(_ app: Application) async throws {
    app.http.server.configuration.port = ::port::

    // Leaf Views + Tags
    app.middleware.use(FileMiddleware(publicDirectory: app.directory.publicDirectory))

    app.views.use(.leaf)

    // Database configurations
    ::fluent::

    ::redis::

    // Session + Token information
    ::sessions::
    app.middleware.use(app.sessions.middleware)

    ::jwt::

    // Auto-Migration configuration
    ::migrations::

    if !app.environment.isRelease {
        let _ = try await app.autoMigrate()
    }

    // Routes information
    try routes(app)
}

